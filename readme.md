# Ski Resort - WP Block

## About Plugin
WordPress plugin that enables a user in the administration panel to insert a gutenburg block in a page/post to present data from a ski resort using Fungg API

## Included
- `.gitignore` - That ignores all WP core files, default themes, plugins, system files and som WP Engine specific stuff.
- `changelog.md` - Basic changelog following the Keep a Changelog standard.
- `.editorconfig` - Basic editor config.
- `readme.md` - This file.
- `package.json` - Package.json is a JSON-formatted file that is used by Node.js to keep track of the dependencies of a project in order to manage and run the project. It specifies the dependencies needed to build a Node.js project and is often used to manage the projectâ€™s dependencies. The file is usually located in the root directory of the project.
- `package-lock.json` - This file is automatically generated for any operations where npm modifies either the node_modules tree or package.json. This file allows users to lock their dependencies to a specific version, reducing the risk of breaking code when upgrading npm packages.
- Theme starting point - See below.
- `ski-resort.php` - Main plugin PHP file. Registers the block.
- `rest.php` - Creating Proxy rest api's.
- `block.json` - This JSON file includes basic metadata regarding the block.
- `edit.js` - Includes an edit component, that represents how a block will behave in Gutenberg editor.
- `save.js` - Includes a save component, that represents how a block should render in the frontend.
- `index.js` - This is where the block registration takes place in the client-side Gutenberg API.
- `editor.scss` - A stylesheet that will be enqueued/applied in the Gutenberg editor.
- `style.scss` - A stylesheet that will be enqueued/applied in on the front-end (only when the block is used).

## Requirements
- node
- npm

## Setup
`$ cd ski-resort` - To enter the folder type:
`$ npm start` - You can start development with:
`$ npm run build` - Builds the code for production.
`$ npm run format` - Formats files.
`$ npm run lint:css` - Lints CSS files.
`$ npm run lint:js` - Lints JavaScript files.
`$ npm run packages-update` - Updates WordPress packages to the latest version.

## Example
- API middleware

```php
add_action(
    'rest_api_init', function () {

        register_rest_route(
            'ski/v1', 'autocomplete(?:/(?P<state>\d+))?', array(
            'methods'             => 'GET',
            'callback' => 'Proxy_Fnugg_Autocomplete_api',
            'args' => [
              'state'
            ],
            )
        );
	}
);

function Proxy_Fnugg_Autocomplete_api($data)
{
    $api_url = "https://api.fnugg.no/suggest/autocomplete/?q=";
    $fetch_url = $api_url;
    $state_id = $data['state'];
    $fetch_data = $state_id;

    if ($fetch_data) {
        $fetch_url .= '?' . $fetch_data;
    }

    $api_response = wp_remote_get($fetch_url);

    if (empty($api_response) || 200 !== $api_response['response']['code'] ) {

        return new WP_Error(
            'error',
            [
            'input'    => $data,
            'response' => $api_response,
            ]
        );
    }

    return new WP_REST_Response(json_decode($api_response['body']));
}
```

## Gutenberg block

